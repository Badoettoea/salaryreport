<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Sistem Manajemen Keuangan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="papaparse.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body.light-mode {
      background: linear-gradient(to bottom right, #ffddd2, #b3e5fc, #e1bee7);
      color: #1e4f5e;
    }
    body.light-mode .text-gray-800 { color: #1e4f5e; }
    body.light-mode .text-gray-600 { color: #4b5e6a; }
    body.light-mode .text-teal-500 { color: #2dd4bf; }
    body.light-mode .text-teal-900 { color: #1e4f5e; }
    body.light-mode .bg-teal-100 { background-color: #e6fffa; }
    body.light-mode .border-teal-600 { border-color: #2dd4bf; }
    body.light-mode .input-field {
      background-color: #ffffff;
      color: #1e4f5e;
      border-color: #2dd4bf;
    }
    body.light-mode .btn-primary { background-color: #2dd4bf; }
    body.light-mode .text-gray-400 { color: #6b7280; }

    body.dark-mode {
      background: linear-gradient(to bottom right, #1e293b, #334155, #4b5e6a);
      color: #e2e8f0;
    }
    body.dark-mode .text-gray-800 { color: #e2e8f0; }
    body.dark-mode .text-gray-600 { color: #94a3b8; }
    body.dark-mode .text-teal-500 { color: #0f766e; }
    body.dark-mode .text-teal-900 { color: #a5f3fc; }
    body.dark-mode .bg-teal-100 { background-color: #2d4a48; }
    body.dark-mode .border-teal-600 { border-color: #0f766e; }
    body.dark-mode .input-field {
      background-color: #334155;
      color: #e2e8f0;
      border-color: #0f766e;
    }
    body.dark-mode .btn-primary { background-color: #0f766e; }
    body.dark-mode .text-gray-400 { color: #94a3b8; }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 20px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #2dd4bf;
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .top-right-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .header-logo {
      width: 40px;
      height: 40px;
    }

    .animate-gradient {
      animation: gradient 15s ease infinite;
      background-size: 400% 400%;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .animate-bounce {
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }
    .animate-slide-in {
      animation: slide-in 0.5s ease-out;
    }
    @keyframes slide-in {
      0% { transform: translateX(-100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6 animate-gradient">
  <div class="login-card relative">
    <div class="absolute top-4 right-4 top-right-container">
      <img src="logo.png" alt="Logo" class="header-logo">
      <div class="theme-toggle">
        <label class="switch">
          <input type="checkbox" id="themeSwitch" onchange="toggleTheme()">
          <span class="slider"></span>
        </label>
        <span class="text-gray-600 text-sm"><i class="fas fa-adjust mr-1"></i>Dark Mode</span>
      </div>
    </div>

    <div class="text-center mb-8">
      <i class="fas fa-wallet text-5xl text-teal-500 mb-3 animate-bounce"></i>
      <h1 class="text-4xl font-bold text-gray-800">Informasi Potongan Gaji</h1>
      <p class="text-gray-600 mt-3 text-lg">Masukkan PIN untuk melanjutkan</p>
    </div>

    <div id="announcement" class="mb-8 p-5 bg-teal-100 rounded-xl text-teal-900 border-l-4 border-teal-600 text-lg animate-slide-in">
      <span id="announcementText"></span>
    </div>

    <div class="space-y-6">
      <div class="relative">
        <input id="pinInput" type="text" placeholder="Masukkan PIN" class="input-field">
        <i class="fas fa-key absolute right-4 top-4 text-gray-400 text-lg animate-pulse"></i>
      </div>

      <button id="loginButton" class="btn-primary ripple">
        <i class="fas fa-sign-in-alt mr-2"></i> Login
      </button>
    </div>
  </div>

  <script>
    const ADMIN_PIN = '12345678';

    function toggleTheme() {
      const body = document.body;
      const isDark = body.classList.contains('dark-mode');
      body.classList.toggle('dark-mode', !isDark);
      body.classList.toggle('light-mode', isDark);
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }

    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.classList.add(savedTheme + '-mode');
      document.getElementById('themeSwitch').checked = savedTheme === 'dark';

      let userData = [];

      function loadUserData() {
        Papa.parse('https://raw.githubusercontent.com/badoettoea/salaryreport/main/data.csv', {
          download: true,
          header: true,
          complete: function(results) {
            userData = results.data;
            loadAnnouncement();
          },
          error: function(error) {
            console.error("Error loading user data:", error);
            alert('Gagal memuat data pengguna. Silakan coba lagi.');
          }
        });
      }

      function loadAnnouncement() {
        const announcement = localStorage.getItem('announcement') || '';
        const announcementEl = document.getElementById('announcementText');
        announcementEl.innerHTML = announcement
          ? `<strong><i class="fas fa-bullhorn mr-2"></i>Pengumuman:</strong> ${announcement}`
          : '<i class="fas fa-info-circle mr-2"></i>Tidak ada pengumuman';
      }

      function login() {
        const pin = document.getElementById('pinInput').value.trim();
        if (!pin) {
          alert('Silakan masukkan PIN terlebih dahulu');
          return;
        }

        if (pin === ADMIN_PIN) {
          localStorage.setItem('currentUser', JSON.stringify({ PIN: pin, Role: 'Admin' }));
          window.location.href = 'admin.html';
          return;
        }

        const user = userData.find(d => d.PIN === pin);
        if (user) {
          localStorage.setItem('currentUser', JSON.stringify(user));
          window.location.href = user.Role === 'Admin' ? 'admin.html' : 'user.html';
        } else {
          alert('PIN tidak valid');
        }
      }

      window.addEventListener('message', (event) => {
        if (event.data.type === 'updateAnnouncement') {
          const newAnnouncement = event.data.text;
          localStorage.setItem('announcement', newAnnouncement);
          loadAnnouncement();
        }
      });

      document.getElementById('loginButton').addEventListener('click', login);

      document.querySelectorAll('.ripple').forEach(button => {
        button.addEventListener('click', function(e) {
          const ripple = document.createElement('span');
          ripple.classList.add('ripple-effect');
          const rect = button.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          ripple.style.width = ripple.style.height = `${size}px`;
          ripple.style.left = `${e.clientX - rect.left - size / 2}px`;
          ripple.style.top = `${e.clientY - rect.top - size / 2}px`;
          button.appendChild(ripple);
          setTimeout(() => ripple.remove(), 600);
        });
      });

      if (typeof Papa === 'undefined') {
        console.error('PapaParse gagal load dari file lokal.');
        alert('Library parsing CSV gagal load. Pastikan file papaparse.min.js ada di repo.');
      } else {
        console.log('PapaParse berhasil load dari file lokal!');
        loadUserData();
      }
    });
  </script>
</body>
</html>
