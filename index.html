<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      transition: all 0.3s ease-in-out;
      font-family: 'Inter', sans-serif;
    }
    .neumorphic {
      background: #e0e7ff;
      border-radius: 12px;
      box-shadow: 6px 6px 12px #c7d2fe, -6px -6px 12px #ffffff;
      transition: all 0.2s ease;
    }
    .neumorphic:hover {
      box-shadow: 3px 3px 6px #c7d2fe, -3px -3px 6px #ffffff;
    }
    .btn-neumorphic {
      background: #e0e7ff;
      box-shadow: 4px 4px 8px #c7d2fe, -4px -4px 8px #ffffff;
    }
    .btn-neumorphic:hover {
      box-shadow: inset 2px 2px 4px #c7d2fe, inset -2px -2px 4px #ffffff;
    }
    @media (max-width: 640px) {
      .container {
        padding: 1rem;
      }
      h1 {
        font-size: 1.5rem;
      }
      h2 {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body class="bg-indigo-50 min-h-screen p-4">
  <div class="container max-w-2xl mx-auto neumorphic p-6">
    <h1 class="text-2xl font-semibold mb-4 text-indigo-700">Admin Dashboard</h1>
    <h2 class="text-lg font-medium mb-2 text-indigo-600">Post Pengumuman</h2>
    <textarea id="announcementText" class="w-full p-3 border-none rounded-lg neumorphic mb-3 text-indigo-800 placeholder-indigo-400 focus:outline-none" rows="4" placeholder="Tulis pengumuman..."></textarea>
    <button onclick="postAnnouncement()" class="w-full sm:w-auto btn-neumorphic text-indigo-700 px-4 py-2 rounded-lg mb-4">Post</button>
    <h2 class="text-lg font-medium mb-2 text-indigo-600">Kelola Database</h2>
    <input type="file" id="csvUpload" accept=".csv" class="mb-3 block w-full text-sm text-indigo-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200">
    <button onclick="uploadDatabase()" class="w-full sm:w-auto btn-neumorphic text-indigo-700 px-4 py-2 rounded-lg mb-4">Upload CSV</button>
    <button onclick="saveAsPDF()" class="w-full sm:w-auto btn-neumorphic text-indigo-700 px-4 py-2 rounded-lg mb-4">Simpan sebagai PDF</button>
    <button onclick="logout()" class="w-full sm:w-auto btn-neumorphic text-red-600 px-4 py-2 rounded-lg">Logout</button>
  </div>

  <script>
    let database = [];

    // Load CSV
    function loadDatabase() {
      Papa.parse('data.csv', {
        download: true,
        header: true,
        complete: function(results) {
          database = results.data;
        }
      });
    }

    function postAnnouncement() {
      const text = document.getElementById('announcementText').value;
      fetch('announcement.txt', {
        method: 'PUT',
        body: text
      }).then(() => {
        alert('Pengumuman dipost!');
        fetch('announcement.txt')
          .then(response => response.text())
          .then(data => {
            if (window.opener) {
              window.opener.document.getElementById('announcement').innerText = data || 'Tidak ada pengumuman.';
            }
          });
      });
    }

    function uploadDatabase() {
      const file = document.getElementById('csvUpload').files[0];
      if (file) {
        Papa.parse(file, {
          header: true,
          complete: function(results) {
            database = results.data;
            const csv = Papa.unparse(results.data);
            fetch('data.csv', {
              method: 'PUT',
              body: csv
            }).then(() => alert('Database diupdate!'));
          }
        });
      }
    }

    function formatAccounting(number) {
      if (!number) return '0';
      const num = parseFloat(number);
      return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(num);
    }

    function saveAsPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(12);
      doc.text('Database Pengguna', 10, 10);
      let y = 20;
      const headers = database.length > 0 ? Object.keys(database[0]) : [];
      headers.forEach((header, i) => doc.text(header, 10 + i * 30, y));
      y += 10;
      database.forEach(row => {
        headers.forEach((header, i) => {
          const value = isNaN(row[header]) ? row[header] : formatAccounting(row[header]);
          doc.text(value || '', 10 + i * 30, y);
        });
        y += 10;
      });
      doc.save('database.pdf');
    }

    function logout() {
      window.location.href = 'index.html';
    }

    loadDatabase();
  </script>
</body>
</html>
