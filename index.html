<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Sistem Informasi Gaji</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700 displayswap" rel="stylesheet">
  <style>
    body.light-mode {
      background-color: #fef5f5;
      color: #1e4f5e;
    }
    body.light-mode .bg-teal-500 { background-color: #2dd4bf; }
    body.light-mode .text-white { color: #ffffff; }
    body.light-mode .bg-teal-50 { background-color: #e6fffa; }
    body.light-mode .text-teal-800 { color: #1e4f5e; }
    body.light-mode .text-teal-600 { color: #1e4f5e; }
    body.light-mode .input-field {
      background-color: #ffffff;
      color: #1e4f5e;
      border-color: #2dd4bf;
    }
    body.light-mode .btn-primary { background-color: #2dd4bf; }

    body.dark-mode {
      background-color: #1e293b;
      color: #e2e8f0;
    }
    body.dark-mode .bg-teal-500 { background-color: #0f766e; }
    body.dark-mode .text-white { color: #e2e8f0; }
    body.dark-mode .bg-teal-50 { background-color: #2d4a48; }
    body.dark-mode .text-teal-800 { color: #a5f3fc; }
    body.dark-mode .text-teal-600 { color: #a5f3fc; }
    body.dark-mode .input-field {
      background-color: #334155;
      color: #e2e8f0;
      border-color: #0f766e;
    }
    body.dark-mode .btn-primary { background-color: #0f766e; }
  </style>
</head>
<body class="min-h-screen p-4 font-poppins flex items-center justify-center transition-colors duration-300">
  <div class="max-w-md w-full">
    <div class="bg-teal-500 p-6 rounded-xl shadow-lg mb-6">
      <h1 class="text-2xl font-bold text-white text-center">
        <i class="fas fa-sign-in-alt mr-2"></i>Sistem Informasi Gaji
      </h1>
    </div>
    <div class="card">
      <h2 class="text-xl font-semibold mb-4 text-teal-600 text-center">
        <i class="fas fa-user-lock mr-2"></i>Login
      </h2>
      <input type="text" id="pinInput" class="input-field mb-4" placeholder="Masukkan PIN">
      <button onclick="login()" class="btn-primary w-full ripple">
        <i class="fas fa-sign-in-alt mr-2"></i>Login
      </button>
    </div>
    <div class="card mt-6">
      <h2 class="text-xl font-semibold mb-4 text-teal-600 text-center">
        <i class="fas fa-bullhorn mr-2"></i>Pengumuman
      </h2>
      <textarea id="announcementDisplay" class="input-field w-full" rows="4" readonly placeholder="Belum ada pengumuman..."></textarea>
    </div>
  </div>

  <script>
    // Apply saved theme on page load
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.classList.add(savedTheme + '-mode');

      // Load announcement from localStorage
      const announcement = localStorage.getItem('announcement') || '';
      document.getElementById('announcementDisplay').value = announcement;

      // Listen for announcement updates from admin.html
      window.addEventListener('message', (event) => {
        if (event.data.type === 'updateAnnouncement') {
          const newAnnouncement = event.data.text;
          localStorage.setItem('announcement', newAnnouncement);
          document.getElementById('announcementDisplay').value = newAnnouncement;
        }
      });

      // Ripple effect for buttons
      document.querySelectorAll('.ripple').forEach(button => {
        button.addEventListener('click', function(e) {
          const ripple = document.createElement('span');
          ripple.classList.add('ripple-effect');
          const rect = button.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          ripple.style.width = ripple.style.height = `${size}px`;
          ripple.style.left = `${e.clientX - rect.left - size / 2}px`;
          ripple.style.top = `${e.clientY - rect.top - size / 2}px`;
          button.appendChild(ripple);
          setTimeout(() => ripple.remove(), 600);
        });
      });
    });

    async function login() {
      const pin = document.getElementById('pinInput').value.trim();
      if (!pin) {
        alert('Silakan masukkan PIN terlebih dahulu');
        return;
      }

      try {
        const response = await fetch('https://raw.githubusercontent.com/badoettoea/salaryreport/main/data.csv');
        if (!response.ok) {
          throw new Error('Gagal mengambil data CSV');
        }
        const csvText = await response.text();

        Papa.parse(csvText, {
          header: true,
          complete: function(results) {
            const user = results.data.find(row => row.PIN === pin);
            if (!user || !user.Role || !user.Nama) {
              alert('PIN salah atau pengguna tidak ditemukan');
              return;
            }

            localStorage.setItem('currentUser', JSON.stringify(user));
            if (user.Role === 'Admin') {
              window.location.href = 'admin.html';
            } else {
              window.location.href = 'user.html';
            }
          },
          error: function(error) {
            console.error('Error parsing CSV:', error);
            alert('Format file CSV tidak valid');
          }
        });
      } catch (error) {
        console.error('Error fetching CSV:', error);
        alert('Gagal mengambil data: ' + error.message);
      }
    }
  </script>
</body>
</html>
